<Window x:Class="Snipr.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:Snipr.ViewModels"
        xmlns:models="clr-namespace:Snipr.Models"
        mc:Ignorable="d"
        Title="Snipr"
        Width="450" Height="85"
        MinWidth="450" MinHeight="85"
        WindowStyle="SingleBorderWindow"
        ResizeMode="NoResize"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource WindowBrush}"
        FontFamily="Segoe UI"
        Topmost="True">

    <Window.InputBindings>
        <KeyBinding Key="N" Modifiers="Ctrl" Command="{Binding NewCaptureCommand}"/>
        <KeyBinding Key="Escape" Command="{Binding CancelCaptureCommand}"/>
        <KeyBinding Key="Q" Modifiers="Ctrl+Shift" Command="{Binding StopRecordingCommand}"/>
        <KeyBinding Key="C" Modifiers="Ctrl" Command="{Binding CopyCommand}"/>
        <KeyBinding Key="S" Modifiers="Ctrl" Command="{Binding SaveCommand}"/>
    </Window.InputBindings>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Top Toolbar -->
        <Grid Grid.Row="0" Margin="12,8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- New/Stop Button -->
            <Button Grid.Column="0"
                    Style="{DynamicResource PrimaryButtonStyle}"
                    Command="{Binding NewCaptureCommand}"
                    Width="85"
                    VerticalAlignment="Center"
                    Visibility="{Binding IsRecording, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="&#xE722;" FontFamily="Segoe MDL2 Assets" FontSize="14" VerticalAlignment="Center" Margin="0,0,6,0"/>
                    <TextBlock Text="New" VerticalAlignment="Center"/>
                </StackPanel>
            </Button>

            <Button Grid.Column="0"
                    Style="{DynamicResource DangerButtonStyle}"
                    Command="{Binding StopRecordingCommand}"
                    Width="85"
                    VerticalAlignment="Center"
                    Visibility="{Binding IsRecording, Converter={StaticResource BoolToVisibilityConverter}}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="&#xE71A;" FontFamily="Segoe MDL2 Assets" FontSize="14" VerticalAlignment="Center" Margin="0,0,6,0"/>
                    <TextBlock Text="Stop" VerticalAlignment="Center"/>
                </StackPanel>
            </Button>

            <!-- Mode Dropdown -->
            <ComboBox Grid.Column="1"
                      ItemsSource="{Binding AvailableModes}"
                      SelectedItem="{Binding SelectedMode}"
                      Style="{DynamicResource ModernComboBoxStyle}"
                      VerticalAlignment="Center"
                      Margin="12,0,0,0"
                      MinWidth="150"
                      IsEnabled="{Binding IsRecording, Converter={StaticResource InverseBoolConverter}}">
                <ComboBox.ItemTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock x:Name="ModeIcon" FontFamily="Segoe MDL2 Assets" FontSize="12" VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <TextBlock Text="{Binding Converter={StaticResource CaptureModeToStringConverter}}" VerticalAlignment="Center"/>
                        </StackPanel>
                        <DataTemplate.Triggers>
                            <DataTrigger Binding="{Binding}" Value="RectangleSnip">
                                <Setter TargetName="ModeIcon" Property="Text" Value="&#xE7A8;"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding}" Value="WindowSnip">
                                <Setter TargetName="ModeIcon" Property="Text" Value="&#xE8A7;"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding}" Value="FullScreenSnip">
                                <Setter TargetName="ModeIcon" Property="Text" Value="&#xE740;"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding}" Value="RectangleVideo">
                                <Setter TargetName="ModeIcon" Property="Text" Value="&#xE714;"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding}" Value="WindowVideo">
                                <Setter TargetName="ModeIcon" Property="Text" Value="&#xE714;"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding}" Value="FullScreenVideo">
                                <Setter TargetName="ModeIcon" Property="Text" Value="&#xE714;"/>
                            </DataTrigger>
                        </DataTemplate.Triggers>
                    </DataTemplate>
                </ComboBox.ItemTemplate>
            </ComboBox>

            <!-- Delay Dropdown -->
            <ComboBox Grid.Column="2"
                      ItemsSource="{Binding AvailableDelays}"
                      SelectedItem="{Binding DelaySeconds}"
                      Style="{DynamicResource ModernComboBoxStyle}"
                      VerticalAlignment="Center"
                      Margin="8,0,0,0"
                      Width="75"
                      IsEnabled="{Binding IsRecording, Converter={StaticResource InverseBoolConverter}}">
                <ComboBox.ItemTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="&#xE823;" FontFamily="Segoe MDL2 Assets" FontSize="12" VerticalAlignment="Center" Margin="0,0,6,0"/>
                            <TextBlock Text="{Binding StringFormat='{}{0}s'}" VerticalAlignment="Center"/>
                        </StackPanel>
                    </DataTemplate>
                </ComboBox.ItemTemplate>
            </ComboBox>

            <!-- Countdown -->
            <TextBlock Grid.Column="3"
                       Text="{Binding CountdownRemaining, StringFormat='{}{0}...'}"
                       FontSize="20"
                       FontWeight="Bold"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center"
                       Foreground="{DynamicResource AccentBrush}"
                       Visibility="{Binding IsDelayCountdownActive, Converter={StaticResource BoolToVisibilityConverter}}"/>

            <!-- Recording Duration -->
            <StackPanel Grid.Column="4"
                        Orientation="Horizontal"
                        VerticalAlignment="Center"
                        Visibility="{Binding IsRecording, Converter={StaticResource BoolToVisibilityConverter}}">
                <Ellipse Width="10" Height="10" Fill="#E81123" Margin="0,0,8,0"/>
                <TextBlock Text="{Binding RecordingDuration}"
                           FontSize="14"
                           FontFamily="Consolas"
                           Foreground="{DynamicResource TextPrimaryBrush}"
                           VerticalAlignment="Center"/>
            </StackPanel>
        </Grid>

        <!-- Preview Content Area -->
        <Grid Grid.Row="1" x:Name="PreviewArea" Visibility="Collapsed">
            <Border Background="#1E1E1E" Margin="8,0,8,0">
                <!-- Screenshot Display -->
                <Image x:Name="ScreenshotImage"
                       Stretch="Uniform"
                       RenderOptions.BitmapScalingMode="HighQuality"
                       Visibility="Collapsed"/>
            </Border>

            <!-- Video Player -->
            <MediaElement x:Name="VideoPlayer"
                          Margin="8,0,8,0"
                          LoadedBehavior="Play"
                          UnloadedBehavior="Stop"
                          Visibility="Collapsed"/>
        </Grid>

        <!-- Bottom Toolbar (visible when previewing) -->
        <Border Grid.Row="2"
                x:Name="PreviewToolbar"
                Background="{DynamicResource ControlBackgroundBrush}"
                BorderBrush="{DynamicResource ControlBorderBrush}"
                BorderThickness="0,1,0,0"
                Padding="12,8"
                Margin="0"
                Visibility="Collapsed">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Info -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock x:Name="InfoText"
                               Foreground="{DynamicResource TextSecondaryBrush}"
                               FontSize="12"
                               VerticalAlignment="Center"/>
                </StackPanel>

                <!-- Buttons -->
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button x:Name="CopyButton"
                            Click="OnCopyClick"
                            Style="{DynamicResource PrimaryButtonStyle}"
                            Margin="0,0,8,0"
                            ToolTip="Copy to clipboard (Ctrl+C)">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="&#xE8C8;" FontFamily="Segoe MDL2 Assets" FontSize="14" VerticalAlignment="Center" Margin="0,0,6,0"/>
                            <TextBlock Text="Copy" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    <Button Click="OnSaveClick"
                            Style="{DynamicResource SecondaryButtonStyle}"
                            Margin="0,0,8,0"
                            ToolTip="Save to file (Ctrl+S)">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="&#xE74E;" FontFamily="Segoe MDL2 Assets" FontSize="14" VerticalAlignment="Center" Margin="0,0,6,0"/>
                            <TextBlock Text="Save As..." VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    <Button Click="OnDiscardClick"
                            Style="{DynamicResource SecondaryButtonStyle}"
                            ToolTip="Discard capture (Escape)">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="&#xE74D;" FontFamily="Segoe MDL2 Assets" FontSize="14" VerticalAlignment="Center" Margin="0,0,6,0"/>
                            <TextBlock Text="Discard" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>
